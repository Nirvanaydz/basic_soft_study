### 常见的三种缓存策略

#### 1、旁路缓存模式，cache aside pattern

- 写：更新db，再删除缓存
- 读：从缓存中读取数据，读取不到查询db并更新缓存
- 写数据是一定要先更新db再删除缓存，存在多线程场景时，数据库更新较慢，会造成数据不一致的情况
    + 请求1先删除缓存数据a-》请求2从db中读取数据-》请求1更改db中的数据
    + 但是不代表按这个顺序一定会一致性，只是发生不一致的概率很小
- 首次请求的数据不在缓存中时，一些热点数据可以优先放置在缓存中
- 写操作较为频繁时，会影响缓存的饿命中率
    + 达到强一致时，保证更新db和更新缓存的原子性，需要增加分布式锁
    + 允许短暂的不一致，适当缩小缓存的过期时间

#### 2、读写穿透模式，read/write through pattern

- 将cache当成是主要的数据存储
- 写：先查询cache，没有直接更新数据库，有的话更新缓存，再由缓存去更新数据库
- 读：先去缓存中查询，没有的话查询db并将数据缓存再返回
- 将热点数据存放在缓存中

#### 3、异步缓存写入，write behind pattern

- 类似于读写穿透模式，但是缓存向数据库写的过程不是同步于写模式下的更新，而是异步批量的更新
- 主要用在可以接收部分数据不一致的情况，数据不是很重要
- 一般用在消息队列异步写入磁盘，mysql中的InnoDB buffer pool机制等