### 1、为什么会有限流/限制了什么

- 并发访问/请求进行限速
- 或者是在一个时间窗口内的请求进行限速
- 限制
    + 总并发数
    + 瞬时并发数
    + 限制时间窗口内的并发数
    + 限制远程接口的调用速率
    + 限制MQ的消费速率

### 2、限流算法介绍

- 令牌桶限流
    + 在固定时间内想令牌桶中添加令牌
    + 令牌桶大小固定，在令牌桶满时新生成的令牌会被丢弃或者拒绝
    + 某个n字节大小的数据包到达时，从令牌桶中删除n个令牌，接着数据包会被发送到网络上
    + 桶中的令牌不足时，会对此数据包限流（丢弃或者在缓冲区等待）
- 漏桶限流
    + 固定容量的漏桶，按照常量固定流出水滴
    + 任意的速率的水滴都可以流入桶中
    + 流入水滴后超出的部分会被丢弃或者等待处理

### 3、应用级的限流

- 限制总并发/连接数/请求数
    + acceptCount/maxConnections/maxThreads
- 限制总资源数
    + 数据库连接
    + 线程数量
- 限制指定接口的总并发/请求数
    + 使用Java中atomicLong/semaphore进行限流
    + hystrix在信号量模式下也是使用Semaphore限制某个接口的并发数
- 限制指定接口每秒/分钟/小时/天的请求调用量
    + 使用guava中的cache来存储计数器，过期时间可以限制，但是此方法较为粗暴
- 平滑的限流某个接口的请求数
    + 令牌桶-可以参考guava中的rateLimiter
    + 漏桶

### 4、分布式限流/lua具体语法需要学习

- redis+lua
- nginx+lua

### 5、接入层的限流

- nginx
    + 连接数限流模块
    + 漏桶算法实现的请求限流模块

### 6、如何节流

- throttleFirst：在一个时间窗口内只处理第一个事件
- throttleLast：在一个时间窗口内只处理最后一个事件
- throttleWithTimeOut：限制两个连续事件的先后执行时间不得小于某个时间窗口
    